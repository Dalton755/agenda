<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Minha Agenda</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        background: #f4f4f4;
        margin: 0;
        padding: 0;
    }
    h1 {
        background: #333;
        color: white;
        padding: 15px 0;
        margin: 0 0 20px;
    }
    #calendar {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
        max-width: 800px;
        margin: auto;
        background: white;
        padding: 10px;
        border-radius: 10px;
    }
    .day {
        padding: 15px;
        border-radius: 5px;
        cursor: pointer;
        background: #eee;
        transition: 0.3s;
    }
    .day:hover {
        background: #ddd;
    }
    .event-day {
        background: #4caf50;
        color: white;
        font-weight: bold;
    }
    .empty {
        background: transparent;
        cursor: default;
    }
    /* Modal */
    #modal {
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.6);
        justify-content: center;
        align-items: center;
    }
    #modal-content {
        background: white;
        padding: 20px;
        border-radius: 10px;
        width: 300px;
        text-align: left;
    }
    #close {
        float: right;
        cursor: pointer;
        color: red;
    }
</style>
</head>
<body>

<h1>Minha Agenda</h1>
<div id="calendar"></div>

<!-- Modal -->
<div id="modal">
    <div id="modal-content">
        <span id="close">✖</span>
        <h3>Detalhes do Agendamento</h3>
        <div id="event-details"></div>
    </div>
</div>

<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRJ1IlvX9wx200jfaQG-iSTSjcuYMPTxVSoftUnTEX9aawQgq8iSH3ZvvJE9PYSjFUFT4HlI-p7MSXv/pub?gid=55604018&single=true&output=csv";
let events = {};

async function loadEvents() {
    const response = await fetch(sheetURL);
    const data = await response.text();
    const rows = data.split("\n").slice(1); // pula cabeçalho

    rows.forEach(row => {
        let [dataEvento, local, observacao, hora] = row.split(",");
        if (dataEvento) {
            dataEvento = dataEvento.trim();
            if (!events[dataEvento]) events[dataEvento] = [];
            events[dataEvento].push({ local, observacao, hora });
        }
    });

    generateCalendar(new Date().getMonth(), new Date().getFullYear());
}

function generateCalendar(month, year) {
    const calendar = document.getElementById("calendar");
    calendar.innerHTML = "";

    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    const daysOfWeek = ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb"];
    daysOfWeek.forEach(d => {
        let div = document.createElement("div");
        div.innerHTML = <b>${d}</b>;
        div.style.background = "#ddd";
        calendar.appendChild(div);
    });

    for (let i = 0; i < firstDay; i++) {
        let empty = document.createElement("div");
        empty.classList.add("empty");
        calendar.appendChild(empty);
    }

    for (let day = 1; day <= daysInMonth; day++) {
        let dateStr = ${day.toString().padStart(2,"0")}/${(month+1).toString().padStart(2,"0")}/${year};
        let div = document.createElement("div");
        div.classList.add("day");
        div.textContent = day;

        if (events[dateStr]) {
            div.classList.add("event-day");
            div.addEventListener("click", () => showEvents(dateStr));
        }

        calendar.appendChild(div);
    }
}

function showEvents(date) {
    document.getElementById("event-details").innerHTML = events[date].map(e => 
        `<p><b>Local:</b> ${e.local || ""}<br>
         <b>Hora:</b> ${e.hora || ""}<br>
         <b>Obs:</b> ${e.observacao || ""}</p>`
    ).join("");
    document.getElementById("modal").style.display = "flex";
}

document.getElementById("close").addEventListener("click", () => {
    document.getElementById("modal").style.display = "none";
});

window.onclick = function(e) {
    if (e.target == document.getElementById("modal")) {
        document.getElementById("modal").style.display = "none";
    }
}

loadEvents();
</script>

</body>
</html>
